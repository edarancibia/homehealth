<div th:include="cabecera-paciente.html" th:remove="tag"></div>

<div class="container">
    <div class="col-md-12 ancho-bordes">
        <p>Documentos adjuntos</p>
        <form class="login100-form validate-form form-inline" th:action="@{/storage/uploadFile}" method="POST" enctype="multipart/form-data">
            <div class="form-group divs-form">
                <div class="col-xs-2">
                    <input type="file" name="file" maxlength="20" class="btn btn-small" id="btnFile">
                    <input type="hidden" name="fileName" id="txtFileName">
                    <input type="hidden" id="txtRutPacFile" name="rutpac">
                    <input type="hidden" id="txtIdfichaFile" name="idficha">
                </div>
            </div>
            <div class="form-group divs-form">
                <div class="col-xs-2">
                    <input type="text" id="txtFileName2" class="form control" name="fileName2" placeholder="Nombre sin espacios" required>
                </div>
            </div>
            <div class="form-group divs-form">
                <div class="col-xs-2">
                    <button type="submit" class="btn btn-small"><i class="fas fa-upload"></i> Cargar</button>
                </div>
            </div>
            <div class="form-group divs-form">
                <div class="col-xs-2">
                    <a th:href="@{'/menu/'+ ${idficha}}" class="btn btn-small"><i class="fas fa-undo-alt"></i> Volver al Men√∫</a>
                </div>
            </div>
        </form>
        


        <table class="table table-striped tabla-ev" id="tabla-files">
            <thead></thead>
        </table>
    </div>
</div>

</body>

<script>
    $(document).ready(function(){

        var base_url = 'https://hhosorno.herokuapp.com/';
        //var base_url = 'http://localhost:8080/';
        var idficha = $('#txtHiddenFicha').val();

        $.ajax({
            type: 'get',
            url: base_url + 'storage/files-list/'+idficha,
            success: function(data){
                console.log(data+ ' rut: '+ $('#txtRut').val());
                $("#tabla-files thead").append("<th>Fecha</th><th>Ficha</th><th>Nombre</th><th>Usuario</th>");
				$('#tabla-files tr').remove();
                $.each(data, function(i, item){
					$('<tr>').html(
                        "<td>"+data[i].fecha+"</td>" +
                        "<td>"+data[i].idficha+"</td>"+
                        "<td><a target='_blank' href="+data[i].url+">"+data[i].descripcion+"</a></td>"+
                        "<td>"+data[i].usuario+"</td>"+
                         "</tr>").appendTo('#tabla-files');
                    });
            },
            error: function(){
                console.log('error al cargar archivos');
            }
        });
    });
</script>
</html>